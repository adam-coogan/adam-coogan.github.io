(self.webpackChunkadam_coogan_github_io=self.webpackChunkadam_coogan_github_io||[]).push([[108],{9483:function(e,n,t){var r=t(7854),a=t(4411),o=t(6330),l=r.TypeError;e.exports=function(e){if(a(e))return e;throw l(o(e)+" is not a constructor")}},1530:function(e,n,t){"use strict";var r=t(8710).charAt;e.exports=function(e,n,t){return n+(t?r(e,n).length:1)}},648:function(e,n,t){var r=t(7854),a=t(1694),o=t(614),l=t(4326),i=t(5112)("toStringTag"),u=r.Object,s="Arguments"==l(function(){return arguments}());e.exports=a?l:function(e){var n,t,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(t=function(e,n){try{return e[n]}catch(t){}}(n=u(e),i))?t:s?l(n):"Object"==(r=l(n))&&o(n.callee)?"Arguments":r}},8544:function(e,n,t){var r=t(7293);e.exports=!r((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},4994:function(e,n,t){"use strict";var r=t(3383).IteratorPrototype,a=t(30),o=t(9114),l=t(8003),i=t(7497),u=function(){return this};e.exports=function(e,n,t){var s=n+" Iterator";return e.prototype=a(r,{next:o(1,t)}),l(e,s,!1,!0),i[s]=u,e}},490:function(e,n,t){var r=t(5005);e.exports=r("document","documentElement")},4411:function(e,n,t){var r=t(1702),a=t(7293),o=t(614),l=t(648),i=t(5005),u=t(2788),s=function(){},c=[],_=i("Reflect","construct"),f=/^\s*(?:class|function)\b/,p=r(f.exec),x=!f.exec(s),m=function(e){if(!o(e))return!1;try{return _(s,c,e),!0}catch(n){return!1}};e.exports=!_||a((function(){var e;return m(m.call)||!m(Object)||!m((function(){e=!0}))||e}))?function(e){if(!o(e))return!1;switch(l(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}return x||!!p(f,u(e))}:m},7850:function(e,n,t){var r=t(111),a=t(4326),o=t(5112)("match");e.exports=function(e){var n;return r(e)&&(void 0!==(n=e[o])?!!n:"RegExp"==a(e))}},3383:function(e,n,t){"use strict";var r,a,o,l=t(7293),i=t(614),u=t(30),s=t(9518),c=t(1320),_=t(5112),f=t(1913),p=_("iterator"),x=!1;[].keys&&("next"in(o=[].keys())?(a=s(s(o)))!==Object.prototype&&(r=a):x=!0),null==r||l((function(){var e={};return r[p].call(e)!==e}))?r={}:f&&(r=u(r)),i(r[p])||c(r,p,(function(){return this})),e.exports={IteratorPrototype:r,BUGGY_SAFARI_ITERATORS:x}},7497:function(e){e.exports={}},30:function(e,n,t){var r,a=t(9670),o=t(6048),l=t(748),i=t(3501),u=t(490),s=t(317),c=t(6200),_=c("IE_PROTO"),f=function(){},p=function(e){return"<script>"+e+"</"+"script>"},x=function(e){e.write(p("")),e.close();var n=e.parentWindow.Object;return e=null,n},m=function(){try{r=new ActiveXObject("htmlfile")}catch(a){}var e,n;m="undefined"!=typeof document?document.domain&&r?x(r):((n=s("iframe")).style.display="none",u.appendChild(n),n.src=String("javascript:"),(e=n.contentWindow.document).open(),e.write(p("document.F=Object")),e.close(),e.F):x(r);for(var t=l.length;t--;)delete m.prototype[l[t]];return m()};i[_]=!0,e.exports=Object.create||function(e,n){var t;return null!==e?(f.prototype=a(e),t=new f,f.prototype=null,t[_]=e):t=m(),void 0===n?t:o(t,n)}},6048:function(e,n,t){var r=t(9781),a=t(3070),o=t(9670),l=t(5656),i=t(1956);e.exports=r?Object.defineProperties:function(e,n){o(e);for(var t,r=l(n),u=i(n),s=u.length,c=0;s>c;)a.f(e,t=u[c++],r[t]);return e}},9518:function(e,n,t){var r=t(7854),a=t(2597),o=t(614),l=t(7908),i=t(6200),u=t(8544),s=i("IE_PROTO"),c=r.Object,_=c.prototype;e.exports=u?c.getPrototypeOf:function(e){var n=l(e);if(a(n,s))return n[s];var t=n.constructor;return o(t)&&n instanceof t?t.prototype:n instanceof c?_:null}},1956:function(e,n,t){var r=t(6324),a=t(748);e.exports=Object.keys||function(e){return r(e,a)}},7651:function(e,n,t){var r=t(7854),a=t(6916),o=t(9670),l=t(614),i=t(4326),u=t(2261),s=r.TypeError;e.exports=function(e,n){var t=e.exec;if(l(t)){var r=a(t,e,n);return null!==r&&o(r),r}if("RegExp"===i(e))return a(u,e,n);throw s("RegExp#exec called on incompatible receiver")}},2261:function(e,n,t){"use strict";var r,a,o=t(6916),l=t(1702),i=t(1340),u=t(7066),s=t(2999),c=t(2309),_=t(30),f=t(9909).get,p=t(9441),x=t(7168),m=c("native-string-replace",String.prototype.replace),d=RegExp.prototype.exec,v=d,g=l("".charAt),h=l("".indexOf),y=l("".replace),E=l("".slice),b=(a=/b*/g,o(d,r=/a/,"a"),o(d,a,"a"),0!==r.lastIndex||0!==a.lastIndex),S=s.BROKEN_CARET,w=void 0!==/()??/.exec("")[1];(b||w||S||p||x)&&(v=function(e){var n,t,r,a,l,s,c,p=this,x=f(p),R=i(e),M=x.raw;if(M)return M.lastIndex=p.lastIndex,n=o(v,M,R),p.lastIndex=M.lastIndex,n;var I=x.groups,A=S&&p.sticky,C=o(u,p),O=p.source,q=0,P=R;if(A&&(C=y(C,"y",""),-1===h(C,"g")&&(C+="g"),P=E(R,p.lastIndex),p.lastIndex>0&&(!p.multiline||p.multiline&&"\n"!==g(R,p.lastIndex-1))&&(O="(?: "+O+")",P=" "+P,q++),t=new RegExp("^(?:"+O+")",C)),w&&(t=new RegExp("^"+O+"$(?!\\s)",C)),b&&(r=p.lastIndex),a=o(d,A?t:p,P),A?a?(a.input=E(a.input,q),a[0]=E(a[0],q),a.index=p.lastIndex,p.lastIndex+=a[0].length):p.lastIndex=0:b&&a&&(p.lastIndex=p.global?a.index+a[0].length:r),w&&a&&a.length>1&&o(m,a[0],t,(function(){for(l=1;l<arguments.length-2;l++)void 0===arguments[l]&&(a[l]=void 0)})),a&&I)for(a.groups=s=_(null),l=0;l<I.length;l++)s[(c=I[l])[0]]=a[c[1]];return a}),e.exports=v},7066:function(e,n,t){"use strict";var r=t(9670);e.exports=function(){var e=r(this),n="";return e.global&&(n+="g"),e.ignoreCase&&(n+="i"),e.multiline&&(n+="m"),e.dotAll&&(n+="s"),e.unicode&&(n+="u"),e.sticky&&(n+="y"),n}},2999:function(e,n,t){var r=t(7293),a=t(7854).RegExp,o=r((function(){var e=a("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),l=o||r((function(){return!a("a","y").sticky})),i=o||r((function(){var e=a("^r","gy");return e.lastIndex=2,null!=e.exec("str")}));e.exports={BROKEN_CARET:i,MISSED_STICKY:l,UNSUPPORTED_Y:o}},9441:function(e,n,t){var r=t(7293),a=t(7854).RegExp;e.exports=r((function(){var e=a(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)}))},7168:function(e,n,t){var r=t(7293),a=t(7854).RegExp;e.exports=r((function(){var e=a("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")}))},8003:function(e,n,t){var r=t(3070).f,a=t(2597),o=t(5112)("toStringTag");e.exports=function(e,n,t){e&&!a(e=t?e:e.prototype,o)&&r(e,o,{configurable:!0,value:n})}},6707:function(e,n,t){var r=t(9670),a=t(9483),o=t(5112)("species");e.exports=function(e,n){var t,l=r(e).constructor;return void 0===l||null==(t=r(l)[o])?n:a(t)}},8710:function(e,n,t){var r=t(1702),a=t(9303),o=t(1340),l=t(4488),i=r("".charAt),u=r("".charCodeAt),s=r("".slice),c=function(e){return function(n,t){var r,c,_=o(l(n)),f=a(t),p=_.length;return f<0||f>=p?e?"":void 0:(r=u(_,f))<55296||r>56319||f+1===p||(c=u(_,f+1))<56320||c>57343?e?i(_,f):r:e?s(_,f,f+2):c-56320+(r-55296<<10)+65536}};e.exports={codeAt:c(!1),charAt:c(!0)}},1694:function(e,n,t){var r={};r[t(5112)("toStringTag")]="z",e.exports="[object z]"===String(r)},1340:function(e,n,t){var r=t(7854),a=t(648),o=r.String;e.exports=function(e){if("Symbol"===a(e))throw TypeError("Cannot convert a Symbol value to a string");return o(e)}},6373:function(e,n,t){"use strict";var r=t(694),a=t(7854),o=t(6916),l=t(1702),i=t(4994),u=t(4488),s=t(7466),c=t(1340),_=t(9670),f=t(4326),p=t(7976),x=t(7850),m=t(7066),d=t(8173),v=t(1320),g=t(7293),h=t(5112),y=t(6707),E=t(1530),b=t(7651),S=t(9909),w=t(1913),R=h("matchAll"),M="RegExp String",I="RegExp String Iterator",A=S.set,C=S.getterFor(I),O=RegExp.prototype,q=a.TypeError,P=l(m),T=l("".indexOf),F=l("".matchAll),k=!!F&&!g((function(){F("a",/./)})),N=i((function(e,n,t,r){A(this,{type:I,regexp:e,string:n,global:t,unicode:r,done:!1})}),M,(function(){var e=C(this);if(e.done)return{value:void 0,done:!0};var n=e.regexp,t=e.string,r=b(n,t);return null===r?{value:void 0,done:e.done=!0}:e.global?(""===c(r[0])&&(n.lastIndex=E(t,s(n.lastIndex),e.unicode)),{value:r,done:!1}):(e.done=!0,{value:r,done:!1})})),D=function(e){var n,t,r,a,o,l,i=_(this),u=c(e);return n=y(i,RegExp),void 0===(t=i.flags)&&p(O,i)&&!("flags"in O)&&(t=P(i)),r=void 0===t?"":c(t),a=new n(n===RegExp?i.source:i,r),o=!!~T(r,"g"),l=!!~T(r,"u"),a.lastIndex=s(i.lastIndex),new N(a,u,o,l)};r({target:"String",proto:!0,forced:k},{matchAll:function(e){var n,t,r,a,l=u(this);if(null!=e){if(x(e)&&(n=c(u("flags"in O?e.flags:P(e))),!~T(n,"g")))throw q("`.matchAll` does not allow non-global regexes");if(k)return F(l,e);if(void 0===(r=d(e,R))&&w&&"RegExp"==f(e)&&(r=D),r)return o(r,e,l)}else if(k)return F(l,e);return t=c(l),a=new RegExp(e,"g"),w?o(D,a,t):a[R](t)}}),w||R in O||v(O,R,D)},3728:function(e,n,t){t(6373)},2337:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return w}});var r=t(9756),a=t(7294),o=t(2109),l="\nattribute vec2 a_position;\n\nuniform float u_range;\nuniform vec2 u_translation;\n\nvarying vec2 v_xy;\n// varying vec2 v_texcoord; // DEBUG\n\nvoid main() {\n  gl_PointSize = 1.0;\n  v_xy = a_position * u_range; // image coordinates\n  // v_texcoord = a_position * 0.5 + 0.5; // texture coordinates\n  gl_Position = vec4(a_position, 0, 1);\n}\n",i=.30966,u=127052815397.49832*(i*Math.pow(1.6,3)+(1-i)),s=function(e){var n=Math.log(1+e)-e/(1+e);return 200/3*Math.pow(e,3)/n},c=function(e){return Math.pow(3/(4*Math.PI)*e/(200*u),1/3)},_=function(e){var n=function(e,n){var t=4-n,r=t>=0?1.7543-.2766*(1+n)+.02039*Math.pow(1+n,2):1.3081-.1078*(1+n)+.00398*Math.pow(1+n,2),a=t>=0?.2753+.0035*(1+n)-.3038*Math.pow(1+n,.0269):.0223-.0944*Math.pow(1+n,-.3907),o=t>=0?.02102*Math.pow(1+n,-.1475)-.01537:0,l=r+a*Math.log10(e)*(1+o*Math.pow(Math.log10(e),2));return Math.pow(10,l)}(e,.6);return{rho_s:u*s(n),r_s:c(e)/n}},f=t(1644),p=t(8220),x=["draw"];p.j_({attribPrefix:"a_"});var m=function(e){for(var n="\nprecision mediump float;\n\n// Noise-free fluxes\nuniform sampler2D u_flux_tex;\n// Noise array\nuniform sampler2D u_noise_tex;\n// Pixelation info\nuniform float u_n_pix_fine;\nuniform float u_n_pix;\n// Intermediate flux scale\nuniform float u_max_flux;\n// Noise scale\nuniform float u_noise_range;\nuniform float u_sigma_n;\n// Flux scale\nuniform float u_low_flux;\nuniform float u_high_flux;\n\n// From https://www.shadertoy.com/view/WlfXRN\nvec3 viridis(float t) {\n  const vec3 c0 = vec3(0.2777273272234177, 0.005407344544966578, 0.3340998053353061);\n  const vec3 c1 = vec3(0.1050930431085774, 1.404613529898575, 1.384590162594685);\n  const vec3 c2 = vec3(-0.3308618287255563, 0.214847559468213, 0.09509516302823659);\n  const vec3 c3 = vec3(-4.634230498983486, -5.799100973351585, -19.33244095627987);\n  const vec3 c4 = vec3(6.228269936347081, 14.17993336680509, 56.69055260068105);\n  const vec3 c5 = vec3(4.776384997670288, -13.74514537774601, -65.35303263337234);\n  const vec3 c6 = vec3(-5.435455855934631, 4.645852612178535, 26.3124352495832);\n\n  return c0 + t * (c1 + t * (c2 + t * (c3 + t * (c4 + t * (c5 + t * c6)))));\n}\n\nfloat unrescale_flux(float r) {\n  return r * u_max_flux;\n}\n\nfloat unrescale_noise(float n) {\n  return 2.0 * (n - 0.5) * u_noise_range * u_sigma_n * 0.5;\n}\n\nfloat rescale_clip_flux(float flux) {\n  float unclipped = (flux - u_low_flux) / (u_high_flux - u_low_flux);\n  return (unclipped < 0.0 ? 0.0 : (unclipped > 1.0 ? 1.0 : unclipped));\n  // return (\n  //   step(0.0, unclipped) *\n  //   step(0.0, 1.0 - unclipped) *\n  //   unclipped + step(1.0, unclipped)\n  // );\n}\n\nvec4 flux_to_noisy_rgba(float flux) {\n  float scaled_noise = texture2D(u_noise_tex, gl_FragCoord.xy / u_n_pix).x;\n  float noisy_flux = unrescale_flux(flux) + unrescale_noise(scaled_noise);\n  return vec4(viridis(rescale_clip_flux(noisy_flux)), 1);\n}\n\nvoid main() {\n  float avg_flux = (\n",t=(e-1)/2,r=-t;r<=t;r++){n+="    //\n";for(var a=-t;a<=t;a++)n+="    texture2D(u_flux_tex, gl_FragCoord.xy / u_n_pix + vec2("+a.toFixed(1)+", "+r.toFixed(1)+") / u_n_pix_fine).x"+(a===t&&r===t?"":" +")+"\n"}return n+="  ) / "+Math.pow(e,2).toFixed(1)+";\n",n+="  gl_FragColor = flux_to_noisy_rgba(avg_flux);",n+="\n}"}(4),d=function(e){var n=e.draw,t=(0,r.Z)(e,x),o=function(e){var n=(0,a.useRef)(null);return(0,a.useEffect)((function(){var t=n.current.getContext("webgl");t||console.log("no webgl!"),e(t)}),[e]),n}(n);return a.createElement("canvas",Object.assign({ref:o},t))},v=function(e){var n=e.label,t=e.value,r=e.set,l=e.min,i=e.max,u=e.description,s=u?a.createElement(a.Fragment,null,a.createElement("label",{style:{flex:2,margin:"0.2rem"},"data-tip":!0,"data-for":u},n),a.createElement(o.Z,{id:u},u)," "):a.createElement("label",{style:{flex:2,margin:"0.2rem"}},n);return a.createElement("div",{style:{display:"flex",alignItems:"center"}},s,a.createElement("input",{style:{flex:1,margin:"0.2rem",minWidth:0},type:"text",min:l,max:i,step:.001,value:t,onChange:function(e){return r(parseFloat(e.target.value))}}),a.createElement("input",{style:{flex:3,margin:"0.2rem"},type:"range",min:l,max:i,step:.001,value:t,onChange:function(e){return r(parseFloat(e.target.value))}}))},g=function(e){var n=e.x,t=e.y,r=e.phiDeg,o=e.q,l=e.index,i=e.r_e,u=e.setX,s=e.setY,c=e.setPhiDeg,_=e.setQ,f=e.setIndex,p=e.setRe;return a.createElement("div",null,a.createElement("h2",null,"Source parameters"),a.createElement(v,{label:"Position (x) ['']",value:n,set:u,min:-2.5,max:2.5}),a.createElement(v,{label:"Position (y) ['']",value:t,set:s,min:-2.5,max:2.5}),a.createElement(v,{label:"Orientation (ϕ) [deg]",value:r,set:c,min:-180,max:180,description:"Orientation of source relative to x-axis"}),a.createElement(v,{label:"Ellipticity (q)",value:o,set:_,min:.15,max:.9999,description:"Controls whether source is circular (q=1) or elliptical (q=0)"}),a.createElement(v,{label:"Index",value:l,set:f,min:.5,max:5,description:"Higher values cause source brightness to decrease sharply with radius"}),a.createElement(v,{label:"Size (r_e) ['']",value:i,set:p,min:1e-4,max:10,description:"Sets the size of the source"}))},h=function(e){var n=e.phiDeg,t=e.q,r=e.r_ein,o=e.setPhiDeg,l=e.setQ,i=e.setRein;return a.createElement("div",null,a.createElement("h2",null,"Lens parameters"),a.createElement(v,{label:"Orientation (ϕ) [deg]",value:n,set:o,min:-180,max:180,description:"Orientation of lens relative to x-axis"}),a.createElement(v,{label:"Ellipticity (q)",value:t,set:l,min:.15,max:.9999,description:"Controls whether lens is circular (q=1) or elliptical (q=0)"}),a.createElement(v,{label:"Einstein radius (r_ein)",value:r,set:i,min:1e-4,max:2.5,description:"Sets the size of the lens"}))},y=function(e){var n=e.sigma_n,t=e.setSigmaN,r=e.setRes,o=e.resampleNoise;return a.createElement("div",null,a.createElement("h2",null,"Telescope"),a.createElement(v,{label:"Noise level",value:n,set:t,min:0,max:3,description:"Telescope noise level"}),a.createElement("button",{style:{margin:"0.1rem"},onClick:function(){return o()}},"Resample noise"),a.createElement("div",null,a.createElement("button",{style:{margin:"0.1rem"},onClick:function(){return r(.012)}},"ELT"),a.createElement("button",{style:{margin:"0.1rem"},onClick:function(){return r(.031)}},"JWST"),a.createElement("button",{style:{margin:"0.1rem"},onClick:function(){return r(.05)}},"Hubble Space Telescope"),a.createElement("button",{style:{margin:"0.1rem"},onClick:function(){return r(.1)}},"Euclid"),a.createElement("button",{style:{margin:"0.1rem"},onClick:function(){return r(.7)}},"Rubin Observatory"),a.createElement("button",{style:{margin:"0.1rem"},onClick:function(){return r(1.25)}},"Chunky")))},E=function(e){var n=e.x,t=e.y,r=e.M_200c,o=e.setX,l=e.setY,i=e.setM200c;return a.createElement("div",null,a.createElement("h2",null,"Subhalo parameters"),a.createElement(v,{label:"Position (x) ['']",value:n,set:o,min:-2.5,max:2.5}),a.createElement(v,{label:"Position (y) ['']",value:t,set:l,min:-2.5,max:2.5}),a.createElement(v,{label:"Mass (M_200c) [M_sun]",value:r,set:i,min:1e5,max:Math.pow(10,10.5),description:"Subhalo mass in radius where density is 200 times rho_cr"}))},b=function(e,n){return Uint8Array.from({length:e},(function(){return Math.floor(256*(Math.max(-n,Math.min(n,(0,f.Bu)()))+n)/(2*n))}))},S=function(e,n,t){return Math.min(e,Math.ceil(2*n/t))},w=function(){var e=(0,a.useState)(.05),n=e[0],t=e[1],r=(0,a.useState)(.1),o=r[0],i=r[1],u=(0,a.useState)(40.107),s=u[0],c=u[1],f=(0,a.useState)(.5),x=f[0],v=f[1],w=(0,a.useState)(4),R=w[0],M=w[1],I=(0,a.useState)(5),A=I[0],C=I[1],O=(0,a.useState)(57.296),q=O[0],P=O[1],T=(0,a.useState)(.75),F=T[0],k=T[1],N=(0,a.useState)(1.5),D=N[0],j=N[1],G=(0,a.useState)(-1.1),L=G[0],U=G[1],B=(0,a.useState)(-1.1),z=B[0],Y=B[1],X=(0,a.useState)(1e10),K=X[0],W=X[1],Q=(0,a.useState)(.1),H=Q[0],Z=Q[1],$=(0,a.useState)(.5),J=$[0],V=$[1],ee=400,ne=S(ee,2.5,H),te=ne*H/2,re=4*ne,ae=(0,a.useState)(b(Math.pow(ne,2),5)),oe=ae[0],le=ae[1],ie=_(K),ue=ie.rho_s,se=ie.r_s;return a.createElement("div",null,a.createElement(d,{draw:function(e){var t=p.EK(e,[l,"\nprecision mediump float;\n\n// Source parameters\nuniform float u_x_s;\nuniform float u_y_s;\nuniform float u_phi_s;\nuniform float u_q_s;\nuniform float u_index;\nuniform float u_r_e;\nuniform float u_I_e;\n// Main lens parameters\nuniform float u_x_l;\nuniform float u_y_l;\nuniform float u_phi_l;\nuniform float u_q_l;\nuniform float u_r_ein;\n// Subhalo parameters\nuniform float u_x_sh;\nuniform float u_y_sh;\nuniform float u_rho_s;\nuniform float u_r_s;\nuniform float u_tau;\n// Intermediate flux scale\nuniform float u_max_flux;\n\n// Image positions\nvarying vec2 v_xy;\n// varying vec2 v_texcoord;\n\n// Subhalo and lens constants\n// TODO: generate shader with correct constants\nfloat pi = 3.1415926535;\nfloat s_min = 1e-12;\nfloat G_over_c2 = 4.79e-20; // Mpc / MSol\nfloat zSrc = 2.5;\nfloat dASrc = 1704.8621; // Mpc\nfloat dALens = 1420.2484; // Mpc\nfloat dComovingSrc = 5967.0171; // Mpc\nfloat dComovingLens = 2272.3975; // Mpc\nfloat dALS = (dComovingSrc - dComovingLens) / (1.0 + zSrc);\nfloat Sigma_cr = 1.0 / (4.0 * pi * G_over_c2 * dALens * dALS / dASrc);\n\nfloat log10(float x) {\n  return log(x) / 2.302585093;\n}\n\nfloat acosh(float x) {\n  return log(x + sqrt(x * x - 1.0));\n}\n\nfloat sersic(float x, float y) {\n  // Position relative to source\n  float dx = x - u_x_s;\n  float dy = y - u_y_s;\n\n  float k = 2.0 * u_index - 1.0 / 3.0 + 4.0 / 405.0 / u_index + 46.0 / 25515.0 / (u_index * u_index);\n  float x_maj = dx * cos(u_phi_s) + dy * sin(u_phi_s);\n  float x_min = -dx * sin(u_phi_s) + dy * cos(u_phi_s);\n  float r = sqrt(x_maj * x_maj * u_q_s + x_min * x_min / u_q_s) / u_r_e;\n  float exponent = -k * (pow(r, 1.0 / u_index) - 1.0);\n  return u_I_e * exp(exponent);\n}\n\nvec2 alpha_sie(float x, float y) {\n  // Transform to elliptical coordinates\n  float dx = x - u_x_l;\n  float dy = y - u_y_l;\n  float rx = (dx * cos(u_phi_l) + dy * sin(u_phi_l)) * sqrt(u_q_l);\n  float ry = (-dx * sin(u_phi_l) + dy * cos(u_phi_l)) / sqrt(u_q_l);\n  float ang = atan(ry, rx);\n\n  // Deflection field in lens frame\n  float alpha_lf_scale =\n    2.0 *\n    u_r_ein *\n    sqrt(u_q_l / (1.0 - u_q_l * u_q_l)) *\n    atan(sqrt((1.0 - u_q_l) / (1.0 + u_q_l)));\n  float alpha_x_lf = alpha_lf_scale * cos(ang);\n  float alpha_y_lf = alpha_lf_scale * sin(ang);\n\n  // Deflection field in image frame\n  float alpha_x = alpha_x_lf * cos(u_phi_l) - alpha_y_lf * sin(u_phi_l);\n  float alpha_y = alpha_x_lf * sin(u_phi_l) + alpha_y_lf * cos(u_phi_l);\n\n  return vec2(alpha_x, alpha_y);\n}\n\nvec2 alpha_tnfw(float x, float y) {\n  // Convert scale radius to angular scale\n  float theta_s = (u_r_s / dALens) * ((180.0 / pi) * 60.0 * 60.0); // arcsec\n\n  float dx = x - u_x_sh;\n  float dy = y - u_y_sh;\n  float s = sqrt(dx * dx + dy * dy) / theta_s;\n  float f =\n    (s >= 1.0 ? acos(1.0 / s) : acosh(1.0 / s)) /\n    sqrt(abs(s * s - 1.0));\n  float l = log((s + s_min) / (sqrt(s * s + u_tau * u_tau) + u_tau));\n  float m =\n    ((4.0 * pi * u_tau * u_tau) / ((u_tau * u_tau + 1.0) * (u_tau * u_tau + 1.0))) *\n    ((u_tau * u_tau + 2.0 * s * s - 1.0) * f +\n      pi * u_tau +\n      (u_tau * u_tau - 1.0) * log(u_tau) +\n      sqrt(s * s + u_tau * u_tau) * (((u_tau * u_tau - 1.0) / u_tau) * l - pi));\n  float k_s = (u_rho_s * u_r_s) / Sigma_cr;\n\n  float alpha_scale = (k_s * m) / pi / ((s + s_min) * (s + s_min));\n  return vec2(alpha_scale * dx, alpha_scale * dy);\n}\n\n// Rescales the flux to (0, 1) and sets to R component of color\nvec4 flux_to_r(float flux) {\n  float unclipped = flux / u_max_flux;\n  // float clipped = step(0.0, unclipped) * step(0.0, 1.0 - unclipped) * unclipped\n  //     + step(1.0, unclipped);\n  float clipped = unclipped < 0.0 ? 0.0 : (unclipped > 1.0 ? 1.0 : unclipped);\n  return vec4(clipped, 0, 0, 1);\n}\n\nvoid main() {\n  vec2 alpha = alpha_sie(v_xy[0], v_xy[1]) + alpha_tnfw(v_xy[0], v_xy[1]);\n  vec2 xy_lensed = v_xy - alpha;\n  float flux = sersic(xy_lensed[0], xy_lensed[1]);\n  gl_FragColor = flux_to_r(flux);\n\n  // // DEBUG: single red pixel\n  // float upsample = 2.0;\n  // vec2 coord = 2.0 * (v_texcoord - 0.5); // texture coordinates\n  // gl_FragColor = vec4(\n  //   step(0.0, coord[0]) *\n  //   step(-0.5 / upsample, -coord[0]) *\n  //   step(0.0, coord[1]) *\n  //   step(-0.5 / upsample, -coord[1]),\n  //   0,\n  //   0,\n  //   1\n  // );\n}\n"]),r=p.EK(e,[l,m]),a=p.qX(e,{position:{numComponents:2,data:[-1,-1,1,-1,-1,1,-1,1,1,1,1,-1]}});p.o8(e,t,a),e.useProgram(t.program);var i={u_x_s:n,u_y_s:o,u_phi_s:s*Math.PI/180,u_q_s:x,u_index:R,u_r_e:A,u_I_e:.05,u_x_l:0,u_y_l:0,u_phi_l:q*Math.PI/180,u_q_l:F,u_r_ein:D,u_x_sh:L,u_y_sh:z,u_rho_s:ue,u_r_s:se,u_tau:6,u_range:te,u_max_flux:23};p.N9(t,i),e.viewport(0,0,re,re),console.assert(e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE,"framebuffer is not ready to display");var u=p.pL(e,[{format:e.RGBA,type:e.UNSIGNED_BYTE,min:e.NEAREST,mag:e.NEAREST,wrap:e.CLAMP_TO_EDGE}],re,re);p.y0(e,a),p.GG(e,null),e.useProgram(r.program);var c=p.cU(e,{format:e.LUMINANCE,min:e.NEAREST,mag:e.NEAREST,wrap:e.CLAMP_TO_EDGE,width:ne,height:ne,src:oe}),_={u_n_pix_fine:re,u_n_pix:ne,u_noise_range:5,u_sigma_n:J,u_max_flux:23,u_low_flux:-3,u_high_flux:18,u_flux_tex:u.attachments[0],u_noise_tex:c};p.N9(r,_),p.y0(e,a)},width:ne,height:ne,style:{width:ee,height:ee,imageRendering:"pixelated"}}),a.createElement(g,{x:n,y:o,phiDeg:s,q:x,index:R,r_e:A,setX:t,setY:i,setPhiDeg:c,setQ:v,setIndex:M,setRe:C}),a.createElement(h,{phiDeg:q,q:F,r_ein:D,setPhiDeg:P,setQ:k,setRein:j}),a.createElement(E,{x:L,y:z,M_200c:K,setX:U,setY:Y,setM200c:W}),a.createElement(y,{sigma_n:J,setSigmaN:V,setRes:function(e){Z(e);var n=S(ee,2.5,e);le(b(Math.pow(n,2),5))},resampleNoise:function(){return le(b(Math.pow(ne,2),5))}}))}}}]);
//# sourceMappingURL=component---src-pages-webgl-tsx-0d66940216eff6efdf10.js.map