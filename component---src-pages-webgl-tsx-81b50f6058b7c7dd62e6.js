(self.webpackChunkadam_coogan_github_io=self.webpackChunkadam_coogan_github_io||[]).push([[108],{9483:function(e,n,t){var a=t(7854),r=t(4411),o=t(6330),i=a.TypeError;e.exports=function(e){if(r(e))return e;throw i(o(e)+" is not a constructor")}},1530:function(e,n,t){"use strict";var a=t(8710).charAt;e.exports=function(e,n,t){return n+(t?a(e,n).length:1)}},648:function(e,n,t){var a=t(7854),r=t(1694),o=t(614),i=t(4326),l=t(5112)("toStringTag"),u=a.Object,s="Arguments"==i(function(){return arguments}());e.exports=r?i:function(e){var n,t,a;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(t=function(e,n){try{return e[n]}catch(t){}}(n=u(e),l))?t:s?i(n):"Object"==(a=i(n))&&o(n.callee)?"Arguments":a}},8544:function(e,n,t){var a=t(7293);e.exports=!a((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},4994:function(e,n,t){"use strict";var a=t(3383).IteratorPrototype,r=t(30),o=t(9114),i=t(8003),l=t(7497),u=function(){return this};e.exports=function(e,n,t){var s=n+" Iterator";return e.prototype=r(a,{next:o(1,t)}),i(e,s,!1,!0),l[s]=u,e}},490:function(e,n,t){var a=t(5005);e.exports=a("document","documentElement")},4411:function(e,n,t){var a=t(1702),r=t(7293),o=t(614),i=t(648),l=t(5005),u=t(2788),s=function(){},c=[],f=l("Reflect","construct"),_=/^\s*(?:class|function)\b/,p=a(_.exec),x=!_.exec(s),d=function(e){if(!o(e))return!1;try{return f(s,c,e),!0}catch(n){return!1}};e.exports=!f||r((function(){var e;return d(d.call)||!d(Object)||!d((function(){e=!0}))||e}))?function(e){if(!o(e))return!1;switch(i(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}return x||!!p(_,u(e))}:d},7850:function(e,n,t){var a=t(111),r=t(4326),o=t(5112)("match");e.exports=function(e){var n;return a(e)&&(void 0!==(n=e[o])?!!n:"RegExp"==r(e))}},3383:function(e,n,t){"use strict";var a,r,o,i=t(7293),l=t(614),u=t(30),s=t(9518),c=t(1320),f=t(5112),_=t(1913),p=f("iterator"),x=!1;[].keys&&("next"in(o=[].keys())?(r=s(s(o)))!==Object.prototype&&(a=r):x=!0),null==a||i((function(){var e={};return a[p].call(e)!==e}))?a={}:_&&(a=u(a)),l(a[p])||c(a,p,(function(){return this})),e.exports={IteratorPrototype:a,BUGGY_SAFARI_ITERATORS:x}},7497:function(e){e.exports={}},30:function(e,n,t){var a,r=t(9670),o=t(6048),i=t(748),l=t(3501),u=t(490),s=t(317),c=t(6200),f=c("IE_PROTO"),_=function(){},p=function(e){return"<script>"+e+"</"+"script>"},x=function(e){e.write(p("")),e.close();var n=e.parentWindow.Object;return e=null,n},d=function(){try{a=new ActiveXObject("htmlfile")}catch(r){}var e,n;d="undefined"!=typeof document?document.domain&&a?x(a):((n=s("iframe")).style.display="none",u.appendChild(n),n.src=String("javascript:"),(e=n.contentWindow.document).open(),e.write(p("document.F=Object")),e.close(),e.F):x(a);for(var t=i.length;t--;)delete d.prototype[i[t]];return d()};l[f]=!0,e.exports=Object.create||function(e,n){var t;return null!==e?(_.prototype=r(e),t=new _,_.prototype=null,t[f]=e):t=d(),void 0===n?t:o(t,n)}},6048:function(e,n,t){var a=t(9781),r=t(3070),o=t(9670),i=t(5656),l=t(1956);e.exports=a?Object.defineProperties:function(e,n){o(e);for(var t,a=i(n),u=l(n),s=u.length,c=0;s>c;)r.f(e,t=u[c++],a[t]);return e}},9518:function(e,n,t){var a=t(7854),r=t(2597),o=t(614),i=t(7908),l=t(6200),u=t(8544),s=l("IE_PROTO"),c=a.Object,f=c.prototype;e.exports=u?c.getPrototypeOf:function(e){var n=i(e);if(r(n,s))return n[s];var t=n.constructor;return o(t)&&n instanceof t?t.prototype:n instanceof c?f:null}},1956:function(e,n,t){var a=t(6324),r=t(748);e.exports=Object.keys||function(e){return a(e,r)}},7651:function(e,n,t){var a=t(7854),r=t(6916),o=t(9670),i=t(614),l=t(4326),u=t(2261),s=a.TypeError;e.exports=function(e,n){var t=e.exec;if(i(t)){var a=r(t,e,n);return null!==a&&o(a),a}if("RegExp"===l(e))return r(u,e,n);throw s("RegExp#exec called on incompatible receiver")}},2261:function(e,n,t){"use strict";var a,r,o=t(6916),i=t(1702),l=t(1340),u=t(7066),s=t(2999),c=t(2309),f=t(30),_=t(9909).get,p=t(9441),x=t(7168),d=c("native-string-replace",String.prototype.replace),m=RegExp.prototype.exec,v=m,h=i("".charAt),g=i("".indexOf),y=i("".replace),E=i("".slice),b=(r=/b*/g,o(m,a=/a/,"a"),o(m,r,"a"),0!==a.lastIndex||0!==r.lastIndex),w=s.BROKEN_CARET,I=void 0!==/()??/.exec("")[1];(b||I||w||p||x)&&(v=function(e){var n,t,a,r,i,s,c,p=this,x=_(p),S=l(e),R=x.raw;if(R)return R.lastIndex=p.lastIndex,n=o(v,R,S),p.lastIndex=R.lastIndex,n;var M=x.groups,D=w&&p.sticky,O=o(u,p),A=p.source,P=0,N=S;if(D&&(O=y(O,"y",""),-1===g(O,"g")&&(O+="g"),N=E(S,p.lastIndex),p.lastIndex>0&&(!p.multiline||p.multiline&&"\n"!==h(S,p.lastIndex-1))&&(A="(?: "+A+")",N=" "+N,P++),t=new RegExp("^(?:"+A+")",O)),I&&(t=new RegExp("^"+A+"$(?!\\s)",O)),b&&(a=p.lastIndex),r=o(m,D?t:p,N),D?r?(r.input=E(r.input,P),r[0]=E(r[0],P),r.index=p.lastIndex,p.lastIndex+=r[0].length):p.lastIndex=0:b&&r&&(p.lastIndex=p.global?r.index+r[0].length:a),I&&r&&r.length>1&&o(d,r[0],t,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(r[i]=void 0)})),r&&M)for(r.groups=s=f(null),i=0;i<M.length;i++)s[(c=M[i])[0]]=r[c[1]];return r}),e.exports=v},7066:function(e,n,t){"use strict";var a=t(9670);e.exports=function(){var e=a(this),n="";return e.global&&(n+="g"),e.ignoreCase&&(n+="i"),e.multiline&&(n+="m"),e.dotAll&&(n+="s"),e.unicode&&(n+="u"),e.sticky&&(n+="y"),n}},2999:function(e,n,t){var a=t(7293),r=t(7854).RegExp,o=a((function(){var e=r("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),i=o||a((function(){return!r("a","y").sticky})),l=o||a((function(){var e=r("^r","gy");return e.lastIndex=2,null!=e.exec("str")}));e.exports={BROKEN_CARET:l,MISSED_STICKY:i,UNSUPPORTED_Y:o}},9441:function(e,n,t){var a=t(7293),r=t(7854).RegExp;e.exports=a((function(){var e=r(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)}))},7168:function(e,n,t){var a=t(7293),r=t(7854).RegExp;e.exports=a((function(){var e=r("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")}))},8003:function(e,n,t){var a=t(3070).f,r=t(2597),o=t(5112)("toStringTag");e.exports=function(e,n,t){e&&!r(e=t?e:e.prototype,o)&&a(e,o,{configurable:!0,value:n})}},6707:function(e,n,t){var a=t(9670),r=t(9483),o=t(5112)("species");e.exports=function(e,n){var t,i=a(e).constructor;return void 0===i||null==(t=a(i)[o])?n:r(t)}},8710:function(e,n,t){var a=t(1702),r=t(9303),o=t(1340),i=t(4488),l=a("".charAt),u=a("".charCodeAt),s=a("".slice),c=function(e){return function(n,t){var a,c,f=o(i(n)),_=r(t),p=f.length;return _<0||_>=p?e?"":void 0:(a=u(f,_))<55296||a>56319||_+1===p||(c=u(f,_+1))<56320||c>57343?e?l(f,_):a:e?s(f,_,_+2):c-56320+(a-55296<<10)+65536}};e.exports={codeAt:c(!1),charAt:c(!0)}},1694:function(e,n,t){var a={};a[t(5112)("toStringTag")]="z",e.exports="[object z]"===String(a)},1340:function(e,n,t){var a=t(7854),r=t(648),o=a.String;e.exports=function(e){if("Symbol"===r(e))throw TypeError("Cannot convert a Symbol value to a string");return o(e)}},6373:function(e,n,t){"use strict";var a=t(694),r=t(7854),o=t(6916),i=t(1702),l=t(4994),u=t(4488),s=t(7466),c=t(1340),f=t(9670),_=t(4326),p=t(7976),x=t(7850),d=t(7066),m=t(8173),v=t(1320),h=t(7293),g=t(5112),y=t(6707),E=t(1530),b=t(7651),w=t(9909),I=t(1913),S=g("matchAll"),R="RegExp String",M="RegExp String Iterator",D=w.set,O=w.getterFor(M),A=RegExp.prototype,P=r.TypeError,N=i(d),q=i("".indexOf),C=i("".matchAll),T=!!C&&!h((function(){C("a",/./)})),F=l((function(e,n,t,a){D(this,{type:M,regexp:e,string:n,global:t,unicode:a,done:!1})}),R,(function(){var e=O(this);if(e.done)return{value:void 0,done:!0};var n=e.regexp,t=e.string,a=b(n,t);return null===a?{value:void 0,done:e.done=!0}:e.global?(""===c(a[0])&&(n.lastIndex=E(t,s(n.lastIndex),e.unicode)),{value:a,done:!1}):(e.done=!0,{value:a,done:!1})})),k=function(e){var n,t,a,r,o,i,l=f(this),u=c(e);return n=y(l,RegExp),void 0===(t=l.flags)&&p(A,l)&&!("flags"in A)&&(t=N(l)),a=void 0===t?"":c(t),r=new n(n===RegExp?l.source:l,a),o=!!~q(a,"g"),i=!!~q(a,"u"),r.lastIndex=s(l.lastIndex),new F(r,u,o,i)};a({target:"String",proto:!0,forced:T},{matchAll:function(e){var n,t,a,r,i=u(this);if(null!=e){if(x(e)&&(n=c(u("flags"in A?e.flags:N(e))),!~q(n,"g")))throw P("`.matchAll` does not allow non-global regexes");if(T)return C(i,e);if(void 0===(a=m(e,S))&&I&&"RegExp"==_(e)&&(a=k),a)return o(a,e,i)}else if(T)return C(i,e);return t=c(i),r=new RegExp(e,"g"),I?o(k,r,t):r[S](t)}}),I||S in A||v(A,S,k)},3728:function(e,n,t){t(6373)},2337:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return O}});var a=t(9756),r=t(7294),o=t(2109),i=t(9),l=t(8220),u="\n// Flux scale\nuniform float u_low_flux;\nuniform float u_high_flux;\n\nfloat rescale_clip_flux(float flux) {\n  float unclipped = (flux - u_low_flux) / (u_high_flux - u_low_flux);\n  return (unclipped < 0.0 ? 0.0 : (unclipped > 1.0 ? 1.0 : unclipped));\n}\n",s="\n// From https://www.shadertoy.com/view/WlfXRN\nvec3 viridis(float t) {\n  const vec3 c0 = vec3(0.2777273272234177, 0.005407344544966578, 0.3340998053353061);\n  const vec3 c1 = vec3(0.1050930431085774, 1.404613529898575, 1.384590162594685);\n  const vec3 c2 = vec3(-0.3308618287255563, 0.214847559468213, 0.09509516302823659);\n  const vec3 c3 = vec3(-4.634230498983486, -5.799100973351585, -19.33244095627987);\n  const vec3 c4 = vec3(6.228269936347081, 14.17993336680509, 56.69055260068105);\n  const vec3 c5 = vec3(4.776384997670288, -13.74514537774601, -65.35303263337234);\n  const vec3 c6 = vec3(-5.435455855934631, 4.645852612178535, 26.3124352495832);\n\n  return c0 + t * (c1 + t * (c2 + t * (c3 + t * (c4 + t * (c5 + t * c6)))));\n}\n",c="\nattribute vec2 a_position;\n\nuniform float u_range;\n\nvarying vec2 v_xy;\n// varying vec2 v_texcoord; // DEBUG\n\nvoid main() {\n  v_xy = a_position * u_range; // image coordinates\n  // v_texcoord = a_position * 0.5 + 0.5; // DEBUG\n  gl_Position = vec4(a_position, 0, 1);\n}\n",f=.30966,_=127052815397.49832*(f*Math.pow(1.6,3)+(1-f)),p=function(e){var n=Math.log(1+e)-e/(1+e);return 200/3*Math.pow(e,3)/n},x=function(e){return Math.pow(3/(4*Math.PI)*e/(200*_),1/3)},d=function(e){var n=function(e,n){var t=4-n,a=t>=0?1.7543-.2766*(1+n)+.02039*Math.pow(1+n,2):1.3081-.1078*(1+n)+.00398*Math.pow(1+n,2),r=t>=0?.2753+.0035*(1+n)-.3038*Math.pow(1+n,.0269):.0223-.0944*Math.pow(1+n,-.3907),o=t>=0?.02102*Math.pow(1+n,-.1475)-.01537:0,i=a+r*Math.log10(e)*(1+o*Math.pow(Math.log10(e),2));return Math.pow(10,i)}(e,.6);return{rho_s:_*p(n),r_s:x(e)/n}},m=t(1644),v=["ctxName","draw"],h=function(e){for(var n="\nprecision mediump float;\n\n// Noise-free fluxes\nuniform sampler2D u_flux_tex;\n\n// Noise array\nuniform sampler2D u_noise_tex;\n\n// Pixelation info\nuniform float u_n_pix_fine;\nuniform float u_n_pix;\n\n// Intermediate flux scale\nuniform float u_max_flux;\n\n// Noise scale\nuniform float u_noise_range;\nuniform float u_sigma_n;\n\n"+s+"\n\nfloat unrescale_flux(float r) {\n  return r * u_max_flux;\n}\n\nfloat unrescale_noise(float n) {\n  return 2.0 * (n - 0.5) * u_noise_range * u_sigma_n * 0.5;\n}\n\n"+u+"\n\nvec4 flux_to_noisy_rgba(float flux) {\n  float scaled_noise = texture2D(u_noise_tex, gl_FragCoord.xy / u_n_pix).x;\n  float noisy_flux = unrescale_flux(flux) + unrescale_noise(scaled_noise);\n  return vec4(viridis(rescale_clip_flux(noisy_flux)), 1);\n}\n\nvoid main() {\n  float avg_flux = (\n",t=(e-1)/2,a=-t;a<=t;a++){n+="    //\n";for(var r=-t;r<=t;r++)n+="    texture2D(u_flux_tex, gl_FragCoord.xy / u_n_pix + vec2("+r.toFixed(1)+", "+a.toFixed(1)+") / u_n_pix_fine).x"+(r===t&&a===t?"":" +")+"\n"}return n+="  ) / "+Math.pow(e,2).toFixed(1)+";\n",n+="  gl_FragColor = flux_to_noisy_rgba(avg_flux);",n+="\n}"}(4),g=i.ZP.button.withConfig({displayName:"webgl__Button",componentId:"cbf3il-0"})(["background-color:",";border-color:",";color:",";margin:0.2em;padding:0.5em 1em;border:2px solid;border-radius:4px;&:hover{background-color:#a6acb1;border-color:#ffffff;color:#ffffff;}&:active{background-color:#6c757d;border-color:#ffffff;color:#ffffff;}"],(function(e){return e.selected?"#6c757d":"#ffffff"}),(function(e){return e.selected?"#ffffff":"#6c757d"}),(function(e){return e.selected?"#ffffff":"#6c757d"})),y=function(e){var n=e.ctxName,t=e.draw,o=(0,a.Z)(e,v),i=function(e,n){var t=(0,r.useRef)(null);return(0,r.useEffect)((function(){var a=t.current.getContext(e);a||console.log("no "+e+"!"),n(a)}),[n]),t}(n,t);return r.createElement("canvas",Object.assign({ref:i},o))},E=function(e){var n=e.label,t=e.value,a=e.set,i=e.min,l=e.max,u=e.description,s=u?r.createElement(r.Fragment,null,r.createElement("label",{style:{flex:2,margin:"0.2rem"},"data-tip":!0,"data-for":u},n),r.createElement(o.Z,{id:u},u)," "):r.createElement("label",{style:{flex:2,margin:"0.2rem"}},n);return r.createElement("div",{style:{width:"35em",display:"flex",alignItems:"center"}},s,r.createElement("input",{style:{flex:1,margin:"0.2rem",minWidth:0},type:"text",min:i,max:l,step:.001,value:t,onChange:function(e){a(parseFloat(e.target.value))}}),r.createElement("input",{style:{flex:3,margin:"0.2rem"},type:"range",min:i,max:l,step:.001,value:t,onChange:function(e){return a(parseFloat(e.target.value))}}))},b=function(e){var n=e.x,t=e.y,a=e.phiDeg,o=e.q,i=e.index,l=e.r_e,u=e.setX,s=e.setY,c=e.setPhiDeg,f=e.setQ,_=e.setIndex,p=e.setRe;return r.createElement("div",null,r.createElement("h2",null,"Source parameters"),r.createElement(E,{label:"Position (x) ['']",value:n,set:u,min:-2.5,max:2.5}),r.createElement(E,{label:"Position (y) ['']",value:t,set:s,min:-2.5,max:2.5}),r.createElement(E,{label:"Orientation (ϕ) [deg]",value:a,set:c,min:-180,max:180,description:"Orientation of source relative to x-axis"}),r.createElement(E,{label:"Ellipticity (q)",value:o,set:f,min:.15,max:.9999,description:"Controls whether source is circular (q=1) or elliptical (q=0)"}),r.createElement(E,{label:"Index",value:i,set:_,min:.5,max:5,description:"Higher values cause source brightness to decrease sharply with radius"}),r.createElement(E,{label:"Size (r_e) ['']",value:l,set:p,min:1e-4,max:10,description:"Sets the size of the source"}))},w=function(e){var n=e.phiDeg,t=e.q,a=e.r_ein,o=e.setPhiDeg,i=e.setQ,l=e.setRein;return r.createElement("div",null,r.createElement("h2",null,"Lens parameters"),r.createElement(E,{label:"Orientation (ϕ) [deg]",value:n,set:o,min:-180,max:180,description:"Orientation of lens relative to x-axis"}),r.createElement(E,{label:"Ellipticity (q)",value:t,set:i,min:.15,max:.9999,description:"Controls whether lens is circular (q=1) or elliptical (q=0)"}),r.createElement(E,{label:"Einstein radius (r_ein)",value:a,set:l,min:1e-4,max:2.5,description:"Sets the size of the lens"}))},I=function(e){var n=e.x,t=e.y,a=e.M_200c,o=e.setX,i=e.setY,l=e.setM200c;return r.createElement("div",null,r.createElement("h2",null,"Subhalo parameters"),r.createElement(E,{label:"Position (x) ['']",value:n,set:o,min:-2.5,max:2.5}),r.createElement(E,{label:"Position (y) ['']",value:t,set:i,min:-2.5,max:2.5}),r.createElement(E,{label:"Log10 mass [M_sun]",value:Math.log10(a),set:function(e){return l(Math.pow(10,e))},min:5,max:10.5,description:"The mass is that of a sphere centered on the subhalo in which the average density is 200 times rho_cr"}))},S=function(e){var n=e.label,t=e.id,a=e.resolution,i=e.setRes,l=e.activeID,u=e.setActiveID,s=e.description;return r.createElement(r.Fragment,null,r.createElement(g,{id:t,selected:t===l,onClick:function(){u(t),i(a)},"data-tip":!0,"data-for":t},n),r.createElement(o.Z,{id:t},s))},R=function(e){var n=e.sigma_n,t=e.setSigmaN,a=e.setRes,o=e.resampleNoise,i=(0,r.useState)("euclid"),l=i[0],u=i[1];return r.createElement("div",null,r.createElement("h2",null,"Telescope"),r.createElement(E,{label:"Noise level",value:n,set:t,min:0,max:3,description:"Scale of telescope noise level"}),r.createElement(g,{onClick:function(){return o()}},"Resample noise"),r.createElement("div",null,r.createElement(S,{label:"ELT",id:"elt",resolution:.012,setRes:a,activeID:l,setActiveID:u,description:"Extremely Large Telescope, 0.004-0.012'' pixel size"}),r.createElement(S,{label:"JWST",id:"jwst",resolution:.031,setRes:a,activeID:l,setActiveID:u,description:"James Webb Space Telescope, 0.031'' pixel size"}),r.createElement(S,{label:"Hubble Space Telescope",id:"hst",resolution:.05,setRes:a,activeID:l,setActiveID:u,description:"0.05'' pixel size"}),r.createElement(S,{label:"Euclid",id:"euclid",resolution:.1,setRes:a,activeID:l,setActiveID:u,description:"0.1'' pixel size"}),r.createElement(S,{label:"Rubin Observatory",id:"rubin",resolution:.7,setRes:a,activeID:l,setActiveID:u,description:"0.7'' seeing"})))},M=function(e,n){return Uint8Array.from({length:e},(function(){return Math.floor(256*(Math.max(-n,Math.min(n,(0,m.Bu)()))+n)/(2*n))}))},D=function(e,n,t){return Math.min(e,Math.ceil(2*n/t))},O=function(){var e=(0,r.useState)(.05),n=e[0],t=e[1],a=(0,r.useState)(.1),i=a[0],u=a[1],s=(0,r.useState)(40.107),f=s[0],_=s[1],p=(0,r.useState)(.5),x=p[0],m=p[1],v=(0,r.useState)(4),g=v[0],E=v[1],S=(0,r.useState)(5),O=S[0],A=S[1],P=(0,r.useState)(57.296),N=P[0],q=P[1],C=(0,r.useState)(.75),T=C[0],F=C[1],k=(0,r.useState)(1.5),j=k[0],G=k[1],L=(0,r.useState)(-1.1),z=L[0],U=L[1],B=(0,r.useState)(-1.1),X=B[0],Z=B[1],W=(0,r.useState)(1e10),Y=W[0],H=W[1],K=(0,r.useState)(.1),V=K[0],Q=K[1],J=(0,r.useState)(.5),$=J[0],ee=J[1],ne=400,te=D(ne,2.5,V),ae=te*V/2,re=4*te,oe=(0,r.useState)(M(Math.pow(te,2),5)),ie=oe[0],le=oe[1],ue=d(Y),se=ue.rho_s,ce=ue.r_s;return r.createElement("div",{style:{display:"flex",flexDirection:"row"}},r.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"left",padding:"0.5rem"}},r.createElement("div",null,r.createElement("h2",{"data-tip":!0,"data-for":"sourceHeaderTT"},"Source"),r.createElement(o.Z,{id:"sourceHeaderTT"},"Source galaxy with no lensing"),r.createElement(y,{ctxName:"webgl",draw:function(e){var t=l.EK(e,[c,"\nprecision mediump float;\n\n// Image positions\nvarying vec2 v_xy;\n\n\n// Source parameters\nuniform float u_x_s;\nuniform float u_y_s;\nuniform float u_phi_s;\nuniform float u_q_s;\nuniform float u_index;\nuniform float u_r_e;\nuniform float u_I_e;\n\nfloat sersic(float x, float y) {\n  // Position relative to source\n  float dx = x - u_x_s;\n  float dy = y - u_y_s;\n\n  float k = 2.0 * u_index - 1.0 / 3.0 + 4.0 / 405.0 / u_index + 46.0 / 25515.0 / (u_index * u_index);\n  float x_maj = dx * cos(u_phi_s) + dy * sin(u_phi_s);\n  float x_min = -dx * sin(u_phi_s) + dy * cos(u_phi_s);\n  float r = sqrt(x_maj * x_maj * u_q_s + x_min * x_min / u_q_s) / u_r_e;\n  float exponent = -k * (pow(r, 1.0 / u_index) - 1.0);\n  return u_I_e * exp(exponent);\n}\n\n\n\n// Flux scale\nuniform float u_low_flux;\nuniform float u_high_flux;\n\nfloat rescale_clip_flux(float flux) {\n  float unclipped = (flux - u_low_flux) / (u_high_flux - u_low_flux);\n  return (unclipped < 0.0 ? 0.0 : (unclipped > 1.0 ? 1.0 : unclipped));\n}\n\n\n\n// From https://www.shadertoy.com/view/WlfXRN\nvec3 viridis(float t) {\n  const vec3 c0 = vec3(0.2777273272234177, 0.005407344544966578, 0.3340998053353061);\n  const vec3 c1 = vec3(0.1050930431085774, 1.404613529898575, 1.384590162594685);\n  const vec3 c2 = vec3(-0.3308618287255563, 0.214847559468213, 0.09509516302823659);\n  const vec3 c3 = vec3(-4.634230498983486, -5.799100973351585, -19.33244095627987);\n  const vec3 c4 = vec3(6.228269936347081, 14.17993336680509, 56.69055260068105);\n  const vec3 c5 = vec3(4.776384997670288, -13.74514537774601, -65.35303263337234);\n  const vec3 c6 = vec3(-5.435455855934631, 4.645852612178535, 26.3124352495832);\n\n  return c0 + t * (c1 + t * (c2 + t * (c3 + t * (c4 + t * (c5 + t * c6)))));\n}\n\n\nvoid main() {\n  float flux = sersic(v_xy[0], v_xy[1]);\n  gl_FragColor = vec4(viridis(rescale_clip_flux(flux)), 1);\n}\n"]);e.useProgram(t.program),l.Lo(e.canvas),e.viewport(0,0,e.canvas.width,e.canvas.height);var a=l.qX(e,{a_position:{size:2,data:[-1,-1,1,-1,-1,1,-1,1,1,1,1,-1]}});l.o8(e,t,a);var r={u_range:ae,u_x_s:n,u_y_s:i,u_phi_s:f*Math.PI/180,u_q_s:x,u_index:g,u_r_e:O,u_I_e:.05,u_low_flux:-3,u_high_flux:18};l.N9(t,r),l.y0(e,a)},width:ne,height:ne,style:{width:ne,height:ne}})),r.createElement(b,{x:n,y:i,phiDeg:f,q:x,index:g,r_e:O,setX:t,setY:u,setPhiDeg:_,setQ:m,setIndex:E,setRe:A}),r.createElement(R,{sigma_n:$,setSigmaN:ee,setRes:function(e){Q(e);var n=D(ne,2.5,e);le(M(Math.pow(n,2),5))},resampleNoise:function(){return le(M(Math.pow(te,2),5))}})),r.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"left",padding:"0.5rem"}},r.createElement("div",null,r.createElement("h2",{"data-tip":!0,"data-for":"obsHeaderTT"},"Observation"),r.createElement(o.Z,{id:"obsHeaderTT"},"Observation of lensed galaxy seen by telescope"),r.createElement("div",{style:{position:"relative",width:ne,height:ne}},r.createElement(y,{ctxName:"webgl",draw:function(e){var t=l.EK(e,[c,"\nprecision mediump float;\n\n// Main lens parameters\nuniform float u_x_l;\nuniform float u_y_l;\nuniform float u_phi_l;\nuniform float u_q_l;\nuniform float u_r_ein;\n\n// Subhalo parameters\nuniform float u_x_sh;\nuniform float u_y_sh;\nuniform float u_rho_s;\nuniform float u_r_s;\nuniform float u_tau;\n\n// Intermediate flux scale\nuniform float u_max_flux;\n\n// Image positions\nvarying vec2 v_xy;\n// varying vec2 v_texcoord; // DEBUG\n\n// Subhalo and lens constants\n// TODO: generate shader with correct constants\n#define PI radians(180.0)\n#define S_MIN 1e-12\n#define G_OVER_C2 4.79e-20 // Mpc / MSol\n#define Z_SRC 2.5\n#define D_A_SRC 1704.8621 // Mpc\n#define D_A_LENS 1420.2484 // Mpc\n#define D_COMOVING_SRC 5967.0171 // Mpc\n#define D_COMOVING_LENS 2272.3975 // Mpc\nfloat dALS = (D_COMOVING_SRC - D_COMOVING_LENS) / (1.0 + Z_SRC);\nfloat Sigma_cr = 1.0 / (4.0 * PI * G_OVER_C2 * D_A_LENS * dALS / D_A_SRC);\n\nfloat log10(float x) {\n  return log(x) / 2.302585093;\n}\n\nfloat acosh(float x) {\n  return log(x + sqrt(x * x - 1.0));\n}\n\n\n// Source parameters\nuniform float u_x_s;\nuniform float u_y_s;\nuniform float u_phi_s;\nuniform float u_q_s;\nuniform float u_index;\nuniform float u_r_e;\nuniform float u_I_e;\n\nfloat sersic(float x, float y) {\n  // Position relative to source\n  float dx = x - u_x_s;\n  float dy = y - u_y_s;\n\n  float k = 2.0 * u_index - 1.0 / 3.0 + 4.0 / 405.0 / u_index + 46.0 / 25515.0 / (u_index * u_index);\n  float x_maj = dx * cos(u_phi_s) + dy * sin(u_phi_s);\n  float x_min = -dx * sin(u_phi_s) + dy * cos(u_phi_s);\n  float r = sqrt(x_maj * x_maj * u_q_s + x_min * x_min / u_q_s) / u_r_e;\n  float exponent = -k * (pow(r, 1.0 / u_index) - 1.0);\n  return u_I_e * exp(exponent);\n}\n\n\nvec2 alpha_sie(float x, float y) {\n  // Transform to elliptical coordinates\n  float dx = x - u_x_l;\n  float dy = y - u_y_l;\n  float rx = (dx * cos(u_phi_l) + dy * sin(u_phi_l)) * sqrt(u_q_l);\n  float ry = (-dx * sin(u_phi_l) + dy * cos(u_phi_l)) / sqrt(u_q_l);\n  float ang = atan(ry, rx);\n\n  // Deflection field in lens frame\n  float alpha_lf_scale =\n    2.0 *\n    u_r_ein *\n    sqrt(u_q_l / (1.0 - u_q_l * u_q_l)) *\n    atan(sqrt((1.0 - u_q_l) / (1.0 + u_q_l)));\n  float alpha_x_lf = alpha_lf_scale * cos(ang);\n  float alpha_y_lf = alpha_lf_scale * sin(ang);\n\n  // Deflection field in image frame\n  float alpha_x = alpha_x_lf * cos(u_phi_l) - alpha_y_lf * sin(u_phi_l);\n  float alpha_y = alpha_x_lf * sin(u_phi_l) + alpha_y_lf * cos(u_phi_l);\n\n  return vec2(alpha_x, alpha_y);\n}\n\nvec2 alpha_tnfw(float x, float y) {\n  // Convert scale radius to angular scale\n  float theta_s = (u_r_s / D_A_LENS) * ((180.0 / PI) * 60.0 * 60.0); // arcsec\n\n  float dx = x - u_x_sh;\n  float dy = y - u_y_sh;\n  float s = sqrt(dx * dx + dy * dy) / theta_s;\n  float f =\n    (s >= 1.0 ? acos(1.0 / s) : acosh(1.0 / s)) /\n    sqrt(abs(s * s - 1.0));\n  float l = log((s + S_MIN) / (sqrt(s * s + u_tau * u_tau) + u_tau));\n  float m =\n    ((4.0 * PI * u_tau * u_tau) / ((u_tau * u_tau + 1.0) * (u_tau * u_tau + 1.0))) *\n    ((u_tau * u_tau + 2.0 * s * s - 1.0) * f +\n      PI * u_tau +\n      (u_tau * u_tau - 1.0) * log(u_tau) +\n      sqrt(s * s + u_tau * u_tau) * (((u_tau * u_tau - 1.0) / u_tau) * l - PI));\n  float k_s = (u_rho_s * u_r_s) / Sigma_cr;\n\n  float alpha_scale = (k_s * m) / PI / ((s + S_MIN) * (s + S_MIN));\n  return vec2(alpha_scale * dx, alpha_scale * dy);\n}\n\n// Rescales the flux to (0, 1) and sets to R component of color\nvec4 flux_to_r(float flux) {\n  float unclipped = flux / u_max_flux;\n  float clipped = unclipped < 0.0 ? 0.0 : (unclipped > 1.0 ? 1.0 : unclipped);\n  return vec4(clipped, 0, 0, 1);\n}\n\nvoid main() {\n  vec2 alpha = alpha_sie(v_xy[0], v_xy[1]) + alpha_tnfw(v_xy[0], v_xy[1]);\n  vec2 xy_lensed = v_xy - alpha;\n  float flux = sersic(xy_lensed[0], xy_lensed[1]);\n  gl_FragColor = flux_to_r(flux);\n\n  // // DEBUG: single red pixel\n  // float upsample = 2.0;\n  // vec2 coord = 2.0 * (v_texcoord - 0.5); // texture coordinates\n  // gl_FragColor = vec4(\n  //   step(0.0, coord[0]) *\n  //   step(-0.5 / upsample, -coord[0]) *\n  //   step(0.0, coord[1]) *\n  //   step(-0.5 / upsample, -coord[1]),\n  //   0,\n  //   0,\n  //   1\n  // );\n}\n"]),a=l.EK(e,[c,h]),r=l.qX(e,{a_position:{size:2,data:[-1,-1,1,-1,-1,1,-1,1,1,1,1,-1]}});l.o8(e,t,r),e.useProgram(t.program);var o={u_range:ae,u_x_s:n,u_y_s:i,u_phi_s:f*Math.PI/180,u_q_s:x,u_index:g,u_r_e:O,u_I_e:.05,u_x_l:0,u_y_l:0,u_phi_l:N*Math.PI/180,u_q_l:T,u_r_ein:j,u_x_sh:z,u_y_sh:X,u_rho_s:se,u_r_s:ce,u_tau:6,u_max_flux:23};l.N9(t,o),console.assert(e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE,"framebuffer is not ready to display");var u=l.pL(e,[{min:e.NEAREST,mag:e.NEAREST,wrap:e.CLAMP_TO_EDGE}],re,re);l.GG(e,u),l.y0(e,r),l.GG(e,null),e.viewport(0,0,te,te),e.useProgram(a.program);var s=l.cU(e,{format:e.LUMINANCE,min:e.NEAREST,mag:e.NEAREST,wrap:e.CLAMP_TO_EDGE,width:te,height:te,src:ie}),_={u_n_pix_fine:re,u_n_pix:te,u_noise_range:5,u_sigma_n:$,u_max_flux:23,u_low_flux:-3,u_high_flux:18,u_flux_tex:u.attachments[0],u_noise_tex:s};l.N9(a,_),l.y0(e,r)},width:te,height:te,style:{position:"absolute",left:"0px",top:"0px",width:ne,height:ne,imageRendering:"pixelated",zIndex:1}}),r.createElement(y,{ctxName:"2d",draw:function(e){var n=e.canvas.width/te;e.clearRect(0,0,e.canvas.width,e.canvas.height),e.save(),e.translate(e.canvas.width/2,e.canvas.height/2),e.strokeStyle="#FF0000",e.beginPath(),e.ellipse(0*n/V,-0*n/V,j/T/V*n,j*T/V*n,-N*Math.PI/180,0,2*Math.PI),e.stroke(),e.beginPath(),e.arc(z*n/V,-X*n/V,3,0,2*Math.PI,!1),e.fillStyle="#FF0000",e.fill(),e.restore()},width:ne,height:ne,style:{position:"absolute",left:"0px",top:"0px",width:ne,height:ne,imageRendering:"pixelated",zIndex:2}}))),r.createElement(w,{phiDeg:N,q:T,r_ein:j,setPhiDeg:q,setQ:F,setRein:G}),r.createElement(I,{x:z,y:X,M_200c:Y,setX:U,setY:Z,setM200c:H})))}}}]);
//# sourceMappingURL=component---src-pages-webgl-tsx-81b50f6058b7c7dd62e6.js.map