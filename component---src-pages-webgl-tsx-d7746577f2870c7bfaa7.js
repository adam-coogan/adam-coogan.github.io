(self.webpackChunkadam_coogan_github_io=self.webpackChunkadam_coogan_github_io||[]).push([[108],{9483:function(e,t,n){var r=n(7854),a=n(4411),o=n(6330),l=r.TypeError;e.exports=function(e){if(a(e))return e;throw l(o(e)+" is not a constructor")}},1530:function(e,t,n){"use strict";var r=n(8710).charAt;e.exports=function(e,t,n){return t+(n?r(e,t).length:1)}},648:function(e,t,n){var r=n(7854),a=n(1694),o=n(614),l=n(4326),i=n(5112)("toStringTag"),u=r.Object,s="Arguments"==l(function(){return arguments}());e.exports=a?l:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(n){}}(t=u(e),i))?n:s?l(t):"Object"==(r=l(t))&&o(t.callee)?"Arguments":r}},8544:function(e,t,n){var r=n(7293);e.exports=!r((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},4994:function(e,t,n){"use strict";var r=n(3383).IteratorPrototype,a=n(30),o=n(9114),l=n(8003),i=n(7497),u=function(){return this};e.exports=function(e,t,n){var s=t+" Iterator";return e.prototype=a(r,{next:o(1,n)}),l(e,s,!1,!0),i[s]=u,e}},490:function(e,t,n){var r=n(5005);e.exports=r("document","documentElement")},4411:function(e,t,n){var r=n(1702),a=n(7293),o=n(614),l=n(648),i=n(5005),u=n(2788),s=function(){},c=[],f=i("Reflect","construct"),_=/^\s*(?:class|function)\b/,p=r(_.exec),x=!_.exec(s),d=function(e){if(!o(e))return!1;try{return f(s,c,e),!0}catch(t){return!1}};e.exports=!f||a((function(){var e;return d(d.call)||!d(Object)||!d((function(){e=!0}))||e}))?function(e){if(!o(e))return!1;switch(l(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}return x||!!p(_,u(e))}:d},7850:function(e,t,n){var r=n(111),a=n(4326),o=n(5112)("match");e.exports=function(e){var t;return r(e)&&(void 0!==(t=e[o])?!!t:"RegExp"==a(e))}},3383:function(e,t,n){"use strict";var r,a,o,l=n(7293),i=n(614),u=n(30),s=n(9518),c=n(1320),f=n(5112),_=n(1913),p=f("iterator"),x=!1;[].keys&&("next"in(o=[].keys())?(a=s(s(o)))!==Object.prototype&&(r=a):x=!0),null==r||l((function(){var e={};return r[p].call(e)!==e}))?r={}:_&&(r=u(r)),i(r[p])||c(r,p,(function(){return this})),e.exports={IteratorPrototype:r,BUGGY_SAFARI_ITERATORS:x}},7497:function(e){e.exports={}},30:function(e,t,n){var r,a=n(9670),o=n(6048),l=n(748),i=n(3501),u=n(490),s=n(317),c=n(6200),f=c("IE_PROTO"),_=function(){},p=function(e){return"<script>"+e+"</"+"script>"},x=function(e){e.write(p("")),e.close();var t=e.parentWindow.Object;return e=null,t},d=function(){try{r=new ActiveXObject("htmlfile")}catch(a){}var e,t;d="undefined"!=typeof document?document.domain&&r?x(r):((t=s("iframe")).style.display="none",u.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(p("document.F=Object")),e.close(),e.F):x(r);for(var n=l.length;n--;)delete d.prototype[l[n]];return d()};i[f]=!0,e.exports=Object.create||function(e,t){var n;return null!==e?(_.prototype=a(e),n=new _,_.prototype=null,n[f]=e):n=d(),void 0===t?n:o(n,t)}},6048:function(e,t,n){var r=n(9781),a=n(3070),o=n(9670),l=n(5656),i=n(1956);e.exports=r?Object.defineProperties:function(e,t){o(e);for(var n,r=l(t),u=i(t),s=u.length,c=0;s>c;)a.f(e,n=u[c++],r[n]);return e}},9518:function(e,t,n){var r=n(7854),a=n(2597),o=n(614),l=n(7908),i=n(6200),u=n(8544),s=i("IE_PROTO"),c=r.Object,f=c.prototype;e.exports=u?c.getPrototypeOf:function(e){var t=l(e);if(a(t,s))return t[s];var n=t.constructor;return o(n)&&t instanceof n?n.prototype:t instanceof c?f:null}},1956:function(e,t,n){var r=n(6324),a=n(748);e.exports=Object.keys||function(e){return r(e,a)}},7651:function(e,t,n){var r=n(7854),a=n(6916),o=n(9670),l=n(614),i=n(4326),u=n(2261),s=r.TypeError;e.exports=function(e,t){var n=e.exec;if(l(n)){var r=a(n,e,t);return null!==r&&o(r),r}if("RegExp"===i(e))return a(u,e,t);throw s("RegExp#exec called on incompatible receiver")}},2261:function(e,t,n){"use strict";var r,a,o=n(6916),l=n(1702),i=n(1340),u=n(7066),s=n(2999),c=n(2309),f=n(30),_=n(9909).get,p=n(9441),x=n(7168),d=c("native-string-replace",String.prototype.replace),m=RegExp.prototype.exec,v=m,h=l("".charAt),g=l("".indexOf),y=l("".replace),E=l("".slice),b=(a=/b*/g,o(m,r=/a/,"a"),o(m,a,"a"),0!==r.lastIndex||0!==a.lastIndex),I=s.BROKEN_CARET,S=void 0!==/()??/.exec("")[1];(b||S||I||p||x)&&(v=function(e){var t,n,r,a,l,s,c,p=this,x=_(p),w=i(e),R=x.raw;if(R)return R.lastIndex=p.lastIndex,t=o(v,R,w),p.lastIndex=R.lastIndex,t;var M=x.groups,A=I&&p.sticky,D=o(u,p),O=p.source,P=0,C=w;if(A&&(D=y(D,"y",""),-1===g(D,"g")&&(D+="g"),C=E(w,p.lastIndex),p.lastIndex>0&&(!p.multiline||p.multiline&&"\n"!==h(w,p.lastIndex-1))&&(O="(?: "+O+")",C=" "+C,P++),n=new RegExp("^(?:"+O+")",D)),S&&(n=new RegExp("^"+O+"$(?!\\s)",D)),b&&(r=p.lastIndex),a=o(m,A?n:p,C),A?a?(a.input=E(a.input,P),a[0]=E(a[0],P),a.index=p.lastIndex,p.lastIndex+=a[0].length):p.lastIndex=0:b&&a&&(p.lastIndex=p.global?a.index+a[0].length:r),S&&a&&a.length>1&&o(d,a[0],n,(function(){for(l=1;l<arguments.length-2;l++)void 0===arguments[l]&&(a[l]=void 0)})),a&&M)for(a.groups=s=f(null),l=0;l<M.length;l++)s[(c=M[l])[0]]=a[c[1]];return a}),e.exports=v},7066:function(e,t,n){"use strict";var r=n(9670);e.exports=function(){var e=r(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},2999:function(e,t,n){var r=n(7293),a=n(7854).RegExp,o=r((function(){var e=a("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),l=o||r((function(){return!a("a","y").sticky})),i=o||r((function(){var e=a("^r","gy");return e.lastIndex=2,null!=e.exec("str")}));e.exports={BROKEN_CARET:i,MISSED_STICKY:l,UNSUPPORTED_Y:o}},9441:function(e,t,n){var r=n(7293),a=n(7854).RegExp;e.exports=r((function(){var e=a(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)}))},7168:function(e,t,n){var r=n(7293),a=n(7854).RegExp;e.exports=r((function(){var e=a("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")}))},8003:function(e,t,n){var r=n(3070).f,a=n(2597),o=n(5112)("toStringTag");e.exports=function(e,t,n){e&&!a(e=n?e:e.prototype,o)&&r(e,o,{configurable:!0,value:t})}},6707:function(e,t,n){var r=n(9670),a=n(9483),o=n(5112)("species");e.exports=function(e,t){var n,l=r(e).constructor;return void 0===l||null==(n=r(l)[o])?t:a(n)}},8710:function(e,t,n){var r=n(1702),a=n(9303),o=n(1340),l=n(4488),i=r("".charAt),u=r("".charCodeAt),s=r("".slice),c=function(e){return function(t,n){var r,c,f=o(l(t)),_=a(n),p=f.length;return _<0||_>=p?e?"":void 0:(r=u(f,_))<55296||r>56319||_+1===p||(c=u(f,_+1))<56320||c>57343?e?i(f,_):r:e?s(f,_,_+2):c-56320+(r-55296<<10)+65536}};e.exports={codeAt:c(!1),charAt:c(!0)}},1694:function(e,t,n){var r={};r[n(5112)("toStringTag")]="z",e.exports="[object z]"===String(r)},1340:function(e,t,n){var r=n(7854),a=n(648),o=r.String;e.exports=function(e){if("Symbol"===a(e))throw TypeError("Cannot convert a Symbol value to a string");return o(e)}},6373:function(e,t,n){"use strict";var r=n(694),a=n(7854),o=n(6916),l=n(1702),i=n(4994),u=n(4488),s=n(7466),c=n(1340),f=n(9670),_=n(4326),p=n(7976),x=n(7850),d=n(7066),m=n(8173),v=n(1320),h=n(7293),g=n(5112),y=n(6707),E=n(1530),b=n(7651),I=n(9909),S=n(1913),w=g("matchAll"),R="RegExp String",M="RegExp String Iterator",A=I.set,D=I.getterFor(M),O=RegExp.prototype,P=a.TypeError,C=l(d),N=l("".indexOf),q=l("".matchAll),F=!!q&&!h((function(){q("a",/./)})),T=i((function(e,t,n,r){A(this,{type:M,regexp:e,string:t,global:n,unicode:r,done:!1})}),R,(function(){var e=D(this);if(e.done)return{value:void 0,done:!0};var t=e.regexp,n=e.string,r=b(t,n);return null===r?{value:void 0,done:e.done=!0}:e.global?(""===c(r[0])&&(t.lastIndex=E(n,s(t.lastIndex),e.unicode)),{value:r,done:!1}):(e.done=!0,{value:r,done:!1})})),k=function(e){var t,n,r,a,o,l,i=f(this),u=c(e);return t=y(i,RegExp),void 0===(n=i.flags)&&p(O,i)&&!("flags"in O)&&(n=C(i)),r=void 0===n?"":c(n),a=new t(t===RegExp?i.source:i,r),o=!!~N(r,"g"),l=!!~N(r,"u"),a.lastIndex=s(i.lastIndex),new T(a,u,o,l)};r({target:"String",proto:!0,forced:F},{matchAll:function(e){var t,n,r,a,l=u(this);if(null!=e){if(x(e)&&(t=c(u("flags"in O?e.flags:C(e))),!~N(t,"g")))throw P("`.matchAll` does not allow non-global regexes");if(F)return q(l,e);if(void 0===(r=m(e,w))&&S&&"RegExp"==_(e)&&(r=k),r)return o(r,e,l)}else if(F)return q(l,e);return n=c(l),a=new RegExp(e,"g"),S?o(k,a,n):a[w](n)}}),S||w in O||v(O,w,k)},3728:function(e,t,n){n(6373)},2337:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return M}});var r=n(9756),a=n(7294),o=n(2109),l=n(9),i=n(8220),u="\nattribute vec2 a_position;\n\nuniform float u_range;\n\nvarying vec2 v_xy;\nvarying vec2 v_texcoord; // DEBUG\n\nvoid main() {\n  v_xy = a_position * u_range; // image coordinates\n  v_texcoord = a_position * 0.5 + 0.5; // DEBUG\n  gl_Position = vec4(a_position, 0, 1);\n}\n",s=.30966,c=127052815397.49832*(s*Math.pow(1.6,3)+(1-s)),f=function(e){var t=Math.log(1+e)-e/(1+e);return 200/3*Math.pow(e,3)/t},_=function(e){return Math.pow(3/(4*Math.PI)*e/(200*c),1/3)},p=function(e){var t=function(e,t){var n=4-t,r=n>=0?1.7543-.2766*(1+t)+.02039*Math.pow(1+t,2):1.3081-.1078*(1+t)+.00398*Math.pow(1+t,2),a=n>=0?.2753+.0035*(1+t)-.3038*Math.pow(1+t,.0269):.0223-.0944*Math.pow(1+t,-.3907),o=n>=0?.02102*Math.pow(1+t,-.1475)-.01537:0,l=r+a*Math.log10(e)*(1+o*Math.pow(Math.log10(e),2));return Math.pow(10,l)}(e,.6);return{rho_s:c*f(t),r_s:_(e)/t}},x=n(1644),d=["ctxName","draw"],m=function(e){for(var t="\nprecision mediump float;\n\n// Noise-free fluxes\nuniform sampler2D u_flux_tex;\n\n// Noise array\nuniform sampler2D u_noise_tex;\n\n// Pixelation info\nuniform float u_n_pix_fine;\nuniform float u_n_pix;\n\n// Intermediate flux scale\nuniform float u_max_flux;\n\n// Noise scale\nuniform float u_noise_range;\nuniform float u_sigma_n;\n\n// Flux scale\nuniform float u_low_flux;\nuniform float u_high_flux;\n\n// From https://www.shadertoy.com/view/WlfXRN\nvec3 viridis(float t) {\n  const vec3 c0 = vec3(0.2777273272234177, 0.005407344544966578, 0.3340998053353061);\n  const vec3 c1 = vec3(0.1050930431085774, 1.404613529898575, 1.384590162594685);\n  const vec3 c2 = vec3(-0.3308618287255563, 0.214847559468213, 0.09509516302823659);\n  const vec3 c3 = vec3(-4.634230498983486, -5.799100973351585, -19.33244095627987);\n  const vec3 c4 = vec3(6.228269936347081, 14.17993336680509, 56.69055260068105);\n  const vec3 c5 = vec3(4.776384997670288, -13.74514537774601, -65.35303263337234);\n  const vec3 c6 = vec3(-5.435455855934631, 4.645852612178535, 26.3124352495832);\n\n  return c0 + t * (c1 + t * (c2 + t * (c3 + t * (c4 + t * (c5 + t * c6)))));\n}\n\nfloat unrescale_flux(float r) {\n  return r * u_max_flux;\n}\n\nfloat unrescale_noise(float n) {\n  return 2.0 * (n - 0.5) * u_noise_range * u_sigma_n * 0.5;\n}\n\nfloat rescale_clip_flux(float flux) {\n  float unclipped = (flux - u_low_flux) / (u_high_flux - u_low_flux);\n  return (unclipped < 0.0 ? 0.0 : (unclipped > 1.0 ? 1.0 : unclipped));\n}\n\nvec4 flux_to_noisy_rgba(float flux) {\n  float scaled_noise = texture2D(u_noise_tex, gl_FragCoord.xy / u_n_pix).x;\n  float noisy_flux = unrescale_flux(flux) + unrescale_noise(scaled_noise);\n  return vec4(viridis(rescale_clip_flux(noisy_flux)), 1);\n}\n\nvoid main() {\n  float avg_flux = (\n",n=(e-1)/2,r=-n;r<=n;r++){t+="    //\n";for(var a=-n;a<=n;a++)t+="    texture2D(u_flux_tex, gl_FragCoord.xy / u_n_pix + vec2("+a.toFixed(1)+", "+r.toFixed(1)+") / u_n_pix_fine).x"+(a===n&&r===n?"":" +")+"\n"}return t+="  ) / "+Math.pow(e,2).toFixed(1)+";\n",t+="  gl_FragColor = flux_to_noisy_rgba(avg_flux);",t+="\n}"}(4),v=l.ZP.button.withConfig({displayName:"webgl__Button",componentId:"cbf3il-0"})(["background-color:",";border-color:",";color:",";margin:0.2em;padding:0.5em 1em;border:2px solid;border-radius:4px;&:hover{background-color:#a6acb1;border-color:#ffffff;color:#ffffff;}&:active{background-color:#6c757d;border-color:#ffffff;color:#ffffff;}"],(function(e){return e.selected?"#6c757d":"#ffffff"}),(function(e){return e.selected?"#ffffff":"#6c757d"}),(function(e){return e.selected?"#ffffff":"#6c757d"})),h=function(e){var t=e.ctxName,n=e.draw,o=(0,r.Z)(e,d),l=function(e,t){var n=(0,a.useRef)(null);return(0,a.useEffect)((function(){var r=n.current.getContext(e);r||console.log("no "+e+"!"),t(r)}),[t]),n}(t,n);return a.createElement("canvas",Object.assign({ref:l},o))},g=function(e){var t=e.label,n=e.value,r=e.set,l=e.min,i=e.max,u=e.description,s=u?a.createElement(a.Fragment,null,a.createElement("label",{style:{flex:2,margin:"0.2rem"},"data-tip":!0,"data-for":u},t),a.createElement(o.Z,{id:u},u)," "):a.createElement("label",{style:{flex:2,margin:"0.2rem"}},t);return a.createElement("div",{style:{width:"35em",display:"flex",alignItems:"center"}},s,a.createElement("input",{style:{flex:1,margin:"0.2rem",minWidth:0},type:"text",min:l,max:i,step:.001,value:n,onChange:function(e){r(parseFloat(e.target.value))}}),a.createElement("input",{style:{flex:3,margin:"0.2rem"},type:"range",min:l,max:i,step:.001,value:n,onChange:function(e){return r(parseFloat(e.target.value))}}))},y=function(e){var t=e.x,n=e.y,r=e.phiDeg,o=e.q,l=e.index,i=e.r_e,u=e.setX,s=e.setY,c=e.setPhiDeg,f=e.setQ,_=e.setIndex,p=e.setRe;return a.createElement("div",null,a.createElement("h2",null,"Source parameters"),a.createElement(g,{label:"Position (x) ['']",value:t,set:u,min:-2.5,max:2.5}),a.createElement(g,{label:"Position (y) ['']",value:n,set:s,min:-2.5,max:2.5}),a.createElement(g,{label:"Orientation (ϕ) [deg]",value:r,set:c,min:-180,max:180,description:"Orientation of source relative to x-axis"}),a.createElement(g,{label:"Ellipticity (q)",value:o,set:f,min:.15,max:.9999,description:"Controls whether source is circular (q=1) or elliptical (q=0)"}),a.createElement(g,{label:"Index",value:l,set:_,min:.5,max:5,description:"Higher values cause source brightness to decrease sharply with radius"}),a.createElement(g,{label:"Size (r_e) ['']",value:i,set:p,min:1e-4,max:10,description:"Sets the size of the source"}))},E=function(e){var t=e.phiDeg,n=e.q,r=e.r_ein,o=e.setPhiDeg,l=e.setQ,i=e.setRein;return a.createElement("div",null,a.createElement("h2",null,"Lens parameters"),a.createElement(g,{label:"Orientation (ϕ) [deg]",value:t,set:o,min:-180,max:180,description:"Orientation of lens relative to x-axis"}),a.createElement(g,{label:"Ellipticity (q)",value:n,set:l,min:.15,max:.9999,description:"Controls whether lens is circular (q=1) or elliptical (q=0)"}),a.createElement(g,{label:"Einstein radius (r_ein)",value:r,set:i,min:1e-4,max:2.5,description:"Sets the size of the lens"}))},b=function(e){var t=e.x,n=e.y,r=e.M_200c,o=e.setX,l=e.setY,i=e.setM200c;return a.createElement("div",null,a.createElement("h2",null,"Subhalo parameters"),a.createElement(g,{label:"Position (x) ['']",value:t,set:o,min:-2.5,max:2.5}),a.createElement(g,{label:"Position (y) ['']",value:n,set:l,min:-2.5,max:2.5}),a.createElement(g,{label:"Log10 mass (log10(M_200c)) [M_sun]",value:Math.log10(r),set:function(e){return i(Math.pow(10,e))},min:5,max:10.5,description:"Subhalo mass in sphere where average density is 200 times rho_cr"}))},I=function(e){var t=e.label,n=e.id,r=e.resolution,l=e.setRes,i=e.activeID,u=e.setActiveID,s=e.description;return a.createElement(a.Fragment,null,a.createElement(v,{id:n,selected:n===i,onClick:function(){u(n),l(r)},"data-tip":!0,"data-for":n},t),a.createElement(o.Z,{id:n},s))},S=function(e){var t=e.sigma_n,n=e.setSigmaN,r=e.setRes,o=e.resampleNoise,l=(0,a.useState)("euclid"),i=l[0],u=l[1];return a.createElement("div",null,a.createElement("h2",null,"Telescope"),a.createElement(g,{label:"Noise level",value:t,set:n,min:0,max:3,description:"Scale of telescope noise level"}),a.createElement(v,{onClick:function(){return o()}},"Resample noise"),a.createElement("div",null,a.createElement(I,{label:"ELT",id:"elt",resolution:.012,setRes:r,activeID:i,setActiveID:u,description:"Extremely Large Telescope, 0.004-0.012'' pixel size"}),a.createElement(I,{label:"JWST",id:"jwst",resolution:.031,setRes:r,activeID:i,setActiveID:u,description:"James Webb Space Telescope, 0.031'' pixel size"}),a.createElement(I,{label:"Hubble Space Telescope",id:"hst",resolution:.05,setRes:r,activeID:i,setActiveID:u,description:"0.05'' pixel size"}),a.createElement(I,{label:"Euclid",id:"euclid",resolution:.1,setRes:r,activeID:i,setActiveID:u,description:"0.1'' pixel size"}),a.createElement(I,{label:"Rubin Observatory",id:"rubin",resolution:.7,setRes:r,activeID:i,setActiveID:u,description:"0.7'' seeing"})))},w=function(e,t){return Uint8Array.from({length:e},(function(){return Math.floor(256*(Math.max(-t,Math.min(t,(0,x.Bu)()))+t)/(2*t))}))},R=function(e,t,n){return Math.min(e,Math.ceil(2*t/n))},M=function(){var e=(0,a.useState)(.05),t=e[0],n=e[1],r=(0,a.useState)(.1),o=r[0],l=r[1],s=(0,a.useState)(40.107),c=s[0],f=s[1],_=(0,a.useState)(.5),x=_[0],d=_[1],v=(0,a.useState)(4),g=v[0],I=v[1],M=(0,a.useState)(5),A=M[0],D=M[1],O=(0,a.useState)(57.296),P=O[0],C=O[1],N=(0,a.useState)(.75),q=N[0],F=N[1],T=(0,a.useState)(1.5),k=T[0],j=T[1],G=(0,a.useState)(-1.1),L=G[0],z=G[1],U=(0,a.useState)(-1.1),B=U[0],X=U[1],Y=(0,a.useState)(1e10),V=Y[0],W=Y[1],Z=(0,a.useState)(.1),K=Z[0],Q=Z[1],H=(0,a.useState)(.5),J=H[0],$=H[1],ee=400,te=R(ee,2.5,K),ne=te*K/2,re=4*te,ae=(0,a.useState)(w(Math.pow(te,2),5)),oe=ae[0],le=ae[1],ie=p(V),ue=ie.rho_s,se=ie.r_s;return a.createElement("div",{style:{display:"flex",flexDirection:"row"}},a.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"left",padding:"0.5rem"}},a.createElement(y,{x:t,y:o,phiDeg:c,q:x,index:g,r_e:A,setX:n,setY:l,setPhiDeg:f,setQ:d,setIndex:I,setRe:D}),a.createElement(S,{sigma_n:J,setSigmaN:$,setRes:function(e){Q(e);var t=R(ee,2.5,e);le(w(Math.pow(t,2),5))},resampleNoise:function(){return le(w(Math.pow(te,2),5))}})),a.createElement("div",null,a.createElement("div",{style:{position:"relative",width:ee,height:ee}},a.createElement(h,{ctxName:"webgl",draw:function(e){var n=i.EK(e,[u,"\nprecision mediump float;\n\n// Source parameters\nuniform float u_x_s;\nuniform float u_y_s;\nuniform float u_phi_s;\nuniform float u_q_s;\nuniform float u_index;\nuniform float u_r_e;\nuniform float u_I_e;\n\n// Main lens parameters\nuniform float u_x_l;\nuniform float u_y_l;\nuniform float u_phi_l;\nuniform float u_q_l;\nuniform float u_r_ein;\n\n// Subhalo parameters\nuniform float u_x_sh;\nuniform float u_y_sh;\nuniform float u_rho_s;\nuniform float u_r_s;\nuniform float u_tau;\n\n// Intermediate flux scale\nuniform float u_max_flux;\n\n// Image positions\nvarying vec2 v_xy;\n// varying vec2 v_texcoord;\n\n// Subhalo and lens constants\n// TODO: generate shader with correct constants\n#define PI radians(180.0)\n#define S_MIN 1e-12\n#define G_OVER_C2 4.79e-20 // Mpc / MSol\n#define Z_SRC 2.5\n#define D_A_SRC 1704.8621 // Mpc\n#define D_A_LENS 1420.2484 // Mpc\n#define D_COMOVING_SRC 5967.0171 // Mpc\n#define D_COMOVING_LENS 2272.3975 // Mpc\nfloat dALS = (D_COMOVING_SRC - D_COMOVING_LENS) / (1.0 + Z_SRC);\nfloat Sigma_cr = 1.0 / (4.0 * PI * G_OVER_C2 * D_A_LENS * dALS / D_A_SRC);\n\nfloat log10(float x) {\n  return log(x) / 2.302585093;\n}\n\nfloat acosh(float x) {\n  return log(x + sqrt(x * x - 1.0));\n}\n\nfloat sersic(float x, float y) {\n  // Position relative to source\n  float dx = x - u_x_s;\n  float dy = y - u_y_s;\n\n  float k = 2.0 * u_index - 1.0 / 3.0 + 4.0 / 405.0 / u_index + 46.0 / 25515.0 / (u_index * u_index);\n  float x_maj = dx * cos(u_phi_s) + dy * sin(u_phi_s);\n  float x_min = -dx * sin(u_phi_s) + dy * cos(u_phi_s);\n  float r = sqrt(x_maj * x_maj * u_q_s + x_min * x_min / u_q_s) / u_r_e;\n  float exponent = -k * (pow(r, 1.0 / u_index) - 1.0);\n  return u_I_e * exp(exponent);\n}\n\nvec2 alpha_sie(float x, float y) {\n  // Transform to elliptical coordinates\n  float dx = x - u_x_l;\n  float dy = y - u_y_l;\n  float rx = (dx * cos(u_phi_l) + dy * sin(u_phi_l)) * sqrt(u_q_l);\n  float ry = (-dx * sin(u_phi_l) + dy * cos(u_phi_l)) / sqrt(u_q_l);\n  float ang = atan(ry, rx);\n\n  // Deflection field in lens frame\n  float alpha_lf_scale =\n    2.0 *\n    u_r_ein *\n    sqrt(u_q_l / (1.0 - u_q_l * u_q_l)) *\n    atan(sqrt((1.0 - u_q_l) / (1.0 + u_q_l)));\n  float alpha_x_lf = alpha_lf_scale * cos(ang);\n  float alpha_y_lf = alpha_lf_scale * sin(ang);\n\n  // Deflection field in image frame\n  float alpha_x = alpha_x_lf * cos(u_phi_l) - alpha_y_lf * sin(u_phi_l);\n  float alpha_y = alpha_x_lf * sin(u_phi_l) + alpha_y_lf * cos(u_phi_l);\n\n  return vec2(alpha_x, alpha_y);\n}\n\nvec2 alpha_tnfw(float x, float y) {\n  // Convert scale radius to angular scale\n  float theta_s = (u_r_s / D_A_LENS) * ((180.0 / PI) * 60.0 * 60.0); // arcsec\n\n  float dx = x - u_x_sh;\n  float dy = y - u_y_sh;\n  float s = sqrt(dx * dx + dy * dy) / theta_s;\n  float f =\n    (s >= 1.0 ? acos(1.0 / s) : acosh(1.0 / s)) /\n    sqrt(abs(s * s - 1.0));\n  float l = log((s + S_MIN) / (sqrt(s * s + u_tau * u_tau) + u_tau));\n  float m =\n    ((4.0 * PI * u_tau * u_tau) / ((u_tau * u_tau + 1.0) * (u_tau * u_tau + 1.0))) *\n    ((u_tau * u_tau + 2.0 * s * s - 1.0) * f +\n      PI * u_tau +\n      (u_tau * u_tau - 1.0) * log(u_tau) +\n      sqrt(s * s + u_tau * u_tau) * (((u_tau * u_tau - 1.0) / u_tau) * l - PI));\n  float k_s = (u_rho_s * u_r_s) / Sigma_cr;\n\n  float alpha_scale = (k_s * m) / PI / ((s + S_MIN) * (s + S_MIN));\n  return vec2(alpha_scale * dx, alpha_scale * dy);\n}\n\n// Rescales the flux to (0, 1) and sets to R component of color\nvec4 flux_to_r(float flux) {\n  float unclipped = flux / u_max_flux;\n  float clipped = unclipped < 0.0 ? 0.0 : (unclipped > 1.0 ? 1.0 : unclipped);\n  return vec4(clipped, 0, 0, 1);\n}\n\nvoid main() {\n  vec2 alpha = alpha_sie(v_xy[0], v_xy[1]) + alpha_tnfw(v_xy[0], v_xy[1]);\n  vec2 xy_lensed = v_xy - alpha;\n  float flux = sersic(xy_lensed[0], xy_lensed[1]);\n  gl_FragColor = flux_to_r(flux);\n\n  // // DEBUG: single red pixel\n  // float upsample = 2.0;\n  // vec2 coord = 2.0 * (v_texcoord - 0.5); // texture coordinates\n  // gl_FragColor = vec4(\n  //   step(0.0, coord[0]) *\n  //   step(-0.5 / upsample, -coord[0]) *\n  //   step(0.0, coord[1]) *\n  //   step(-0.5 / upsample, -coord[1]),\n  //   0,\n  //   0,\n  //   1\n  // );\n}\n"]),r=i.EK(e,[u,m]),a=i.qX(e,{a_position:{size:2,data:[-1,-1,1,-1,-1,1,-1,1,1,1,1,-1]}});i.o8(e,n,a),e.useProgram(n.program);var l={u_x_s:t,u_y_s:o,u_phi_s:c*Math.PI/180,u_q_s:x,u_index:g,u_r_e:A,u_I_e:.05,u_x_l:0,u_y_l:0,u_phi_l:P*Math.PI/180,u_q_l:q,u_r_ein:k,u_x_sh:L,u_y_sh:B,u_rho_s:ue,u_r_s:se,u_tau:6,u_range:ne,u_max_flux:23};i.N9(n,l),console.assert(e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE,"framebuffer is not ready to display");var s=i.pL(e,[{min:e.NEAREST,mag:e.NEAREST,wrap:e.CLAMP_TO_EDGE}],re,re);i.GG(e,s),i.y0(e,a),i.GG(e,null),e.viewport(0,0,te,te),e.useProgram(r.program);var f=i.cU(e,{format:e.LUMINANCE,min:e.NEAREST,mag:e.NEAREST,wrap:e.CLAMP_TO_EDGE,width:te,height:te,src:oe}),_={u_n_pix_fine:re,u_n_pix:te,u_noise_range:5,u_sigma_n:J,u_max_flux:23,u_low_flux:-3,u_high_flux:18,u_flux_tex:s.attachments[0],u_noise_tex:f};i.N9(r,_),i.y0(e,a)},width:te,height:te,style:{position:"absolute",left:"0px",top:"0px",width:ee,height:ee,imageRendering:"pixelated",zIndex:1}}),a.createElement(h,{ctxName:"2d",draw:function(e){var t=e.canvas.width/te;e.clearRect(0,0,ee,ee),e.save(),e.translate(e.canvas.width/2,e.canvas.height/2),e.strokeStyle="#FF0000",e.beginPath(),e.ellipse(0*t/K,-0*t/K,k/q/K*t,k*q/K*t,-P*Math.PI/180,0,2*Math.PI),e.stroke(),e.beginPath(),e.arc(L*t/K,-B*t/K,3,0,2*Math.PI,!1),e.fillStyle="#FF0000",e.fill(),e.restore()},width:ee,height:ee,style:{position:"absolute",left:"0px",top:"0px",width:ee,height:ee,imageRendering:"pixelated",zIndex:2}})),a.createElement(E,{phiDeg:P,q:q,r_ein:k,setPhiDeg:C,setQ:F,setRein:j}),a.createElement(b,{x:L,y:B,M_200c:V,setX:z,setY:X,setM200c:W})))}}}]);
//# sourceMappingURL=component---src-pages-webgl-tsx-d7746577f2870c7bfaa7.js.map